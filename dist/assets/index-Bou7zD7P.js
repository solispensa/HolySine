var $=Object.defineProperty;var G=(s,t,n)=>t in s?$(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n;var M=(s,t,n)=>G(s,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const e of i)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const e={};return i.integrity&&(e.integrity=i.integrity),i.referrerPolicy&&(e.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?e.credentials="include":i.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function l(i){if(i.ep)return;i.ep=!0;const e=n(i);fetch(i.href,e)}})();const g=class g{constructor(){this.audioContext=null,this.analyser=null,this.microphone=null,this.dataArray=null,this.isInitialized=!1,this.onUpdate=null}async initialize(){if(!this.isInitialized)try{this.audioContext=new(window.AudioContext||window.webkitAudioContext);const t=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}});return this.microphone=this.audioContext.createMediaStreamSource(t),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=8192,this.microphone.connect(this.analyser),this.dataArray=new Float32Array(this.analyser.fftSize),this.isInitialized=!0,this.startProcessing(),!0}catch(t){return console.error("Error accessing microphone:",t),!1}}startProcessing(){const t=()=>{this.isInitialized&&(this.analyser.getFloatTimeDomainData(this.dataArray),requestAnimationFrame(t))};t()}static autoCorrelate(t,n){let l=t.length,i=0;for(let r=0;r<l;r++)i+=t[r]*t[r];if(i=Math.sqrt(i/l),i<.002)return-1;const e=Math.floor(n/1200),a=Math.floor(n/40),c=Math.floor(l/2),o=new Float32Array(a+1);for(let r=e;r<=a;r++)for(let d=0;d<c;d++){const y=t[d]-t[d+r];o[r]+=y*y}let h=-1,f=1/0,u=.2*o[e];for(let r=e;r<=a;r++)if(o[r]<f&&(f=o[r],h=r),r>e&&o[r]<u&&o[r]<o[r-1]&&o[r]<o[r+1]){h=r;break}if(h===-1)return-1;let m=h;if(m>0&&m<a){const r=o[m-1],d=o[m],y=o[m+1],v=(r+y-2*d)/2,C=(y-r)/2;v&&(m=m-C/(2*v))}return n/m}static getNoteFromFrequency(t){if(t<=0||isNaN(t))return null;const n=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=12*Math.log2(t/g.referencePitch),i=Math.round(l),e=(i+69)%12,a=Math.floor((i+69)/12)-1,c=100*(l-i);return{name:n[e<0?e+12:e],octave:a,cents:c,frequency:parseFloat(t.toFixed(2))}}getPolyNotes(t){if(!this.dataArray)return[];const n=this.audioContext.sampleRate,l=this.analyser.frequencyBinCount,i=this.analyser.fftSize,e=new Float32Array(l);this.analyser.getFloatFrequencyData(e);const a=[];return t.forEach(c=>{const o=c.freq*Math.pow(2,-.125),h=c.freq*Math.pow(2,1.5/12);let f=-1/0,u=-1;const m=Math.floor(o*i/n),r=Math.ceil(h*i/n);if(!(m<0||r>=l)){for(let d=m;d<=r;d++)e[d]>f&&(f=e[d],u=d);if(f>-95){const d=e[u-1]||e[u],y=e[u],v=e[u+1]||e[u];let C=u*n/i;if(d!==y||y!==v){const T=.5*(d-v)/(d-2*y+v);C=(u+T)*n/i}const P=g.getNoteFromFrequency(C);a.push({...P,magnitude:f,targetFreq:c.freq})}}}),a}getMonoNote(){if(!this.dataArray)return null;const t=this.audioContext.sampleRate,n=g.autoCorrelate(this.dataArray,t);if(n!==-1&&n<1200)return g.getNoteFromFrequency(n);const l=this.analyser.frequencyBinCount,i=this.analyser.fftSize,e=new Float32Array(l);this.analyser.getFloatFrequencyData(e);let a=-1/0,c=-1;for(let o=2;o<l;o++)e[o]>a&&(a=e[o],c=o);if(a>-90&&c>0){const o=e[c-1]||e[c],h=e[c],f=e[c+1]||e[c];let u=c*t/i;if(o!==h||h!==f){const m=.5*(o-f)/(o-2*h+f);u=(c+m)*t/i}return g.getNoteFromFrequency(u)}return null}};M(g,"referencePitch",440);let F=g;const q=new F,H=document.getElementById("start-audio"),O=document.getElementById("initial-overlay"),z=document.querySelectorAll(".nav-item"),R=document.querySelectorAll(".view"),k={standard:[{id:6,note:"E",octave:2,midi:40},{id:5,note:"A",octave:2,midi:45},{id:4,note:"D",octave:3,midi:50},{id:3,note:"G",octave:3,midi:55},{id:2,note:"B",octave:3,midi:59},{id:1,note:"e",octave:4,midi:64}],drop_d:[{id:6,note:"D",octave:2,midi:38},{id:5,note:"A",octave:2,midi:45},{id:4,note:"D",octave:3,midi:50},{id:3,note:"G",octave:3,midi:55},{id:2,note:"B",octave:3,midi:59},{id:1,note:"e",octave:4,midi:64}],open_g:[{id:6,note:"D",octave:2,midi:38},{id:5,note:"G",octave:2,midi:43},{id:4,note:"D",octave:3,midi:50},{id:3,note:"G",octave:3,midi:55},{id:2,note:"B",octave:3,midi:59},{id:1,note:"d",octave:4,midi:62}]};let B="standard",I=440,E=[];function S(){E=k[B].map(s=>({...s,targetFreq:I*Math.pow(2,(s.midi-69)/12)})),F.referencePitch=I}S();document.querySelectorAll('input[name="tuning"]').forEach(s=>{s.addEventListener("change",t=>{B=t.target.value,S(),A()})});const p=document.getElementById("pitch-slider"),D=document.getElementById("pitch-val");function L(){if(!p)return;const s=(p.value-p.min)/(p.max-p.min)*100;p.style.background=`linear-gradient(to right, #00ff88 0%, #00ff88 ${s}%, rgba(255, 255, 255, 0.1) ${s}%, rgba(255, 255, 255, 0.1) 100%)`}p&&D&&(p.addEventListener("input",s=>{I=parseInt(s.target.value,10),D.textContent=`${I} Hz`,L(),S(),A()}),L());class b{constructor(t,n=null){this.container=t,this.stringInfo=n,this.element=this.createCard(),this.container.appendChild(this.element),this.canvas=this.element.querySelector(".oscilloscope-canvas"),this.ctx=this.canvas.getContext("2d"),this.history=new Array(100).fill(0),this.isActuallyDetected=!1,this.resize(),window.addEventListener("resize",()=>this.resize())}createCard(){const t=document.createElement("div");t.className="tuning-card";const n=this.stringInfo?`${this.stringInfo.id} - ${this.stringInfo.note}`:"1 - E";return t.innerHTML=`
      <div class="card-header">
        <div class="string-info">${n}</div>
        <div class="measurement-info">
          <span class="cents-display">+0.0</span>
          <span class="cents-label">Cents</span>
          <span class="freq-display">0.0 Hz</span>
        </div>
      </div>
      <div class="scale-container">
        <div class="scale-markers">
          <span>-50</span>
          <span>-30</span>
          <span>-20</span>
          <span>-10</span>
          <span>0</span>
          <span>+10</span>
          <span>+20</span>
          <span>+30</span>
          <span>+50</span>
        </div>
        <div class="scale-line"></div>
        <canvas class="oscilloscope-canvas"></canvas>
      </div>
    `,t}resize(){this.canvas.width=this.canvas.clientWidth*window.devicePixelRatio,this.canvas.height=this.canvas.clientHeight*window.devicePixelRatio}update(t){const{cents:n,frequency:l,isDetected:i,name:e,octave:a}=t,c=this.element.querySelector(".cents-display"),o=this.element.querySelector(".freq-display"),h=this.element.querySelector(".string-info");if(this.isActuallyDetected=i,i){const f=typeof l=="number"?l:parseFloat(l);c.textContent=(n>=0?"+":"")+n.toFixed(1),o.textContent=f.toFixed(1)+" Hz",this.stringInfo?h.textContent=`${this.stringInfo.id} - ${e}${a}`:h.textContent=`${e}${a}`,this.history.push(n),this.history.shift(),Math.abs(n)<5?this.element.classList.add("in-tune"):this.element.classList.remove("in-tune")}else c.textContent="+0.0",o.textContent="0.0 Hz",this.element.classList.remove("in-tune"),this.stringInfo?h.textContent=`${this.stringInfo.id} - ${this.stringInfo.note}`:h.textContent="---",this.history.push(null),this.history.shift();this.drawHistory()}drawHistory(){const t=this.canvas.width,n=this.canvas.height;this.ctx.clearRect(0,0,t,n);const l=n/(this.history.length-1);this.ctx.beginPath(),this.ctx.lineWidth=3,this.ctx.strokeStyle="#ffffff",this.ctx.lineCap="round",this.ctx.lineJoin="round";let i=!0;for(let e=0;e<this.history.length;e++){const a=this.history[e];if(a===null){i=!0;continue}const c=t/2+a/50*(t*.4),o=n-e*l;i?(this.ctx.moveTo(c,o),i=!1):this.ctx.lineTo(c,o)}this.ctx.shadowBlur=10,this.ctx.shadowColor="rgba(255, 255, 255, 0.5)",this.ctx.stroke(),this.ctx.shadowBlur=0}}let w=null,x=[];function V(){const s=document.getElementById("simple-tuner-container");w=new b(s),A()}function A(){const s=document.getElementById("poly-tuner-grid");if(s){s.innerHTML="",x=E.map(n=>new b(s,n));const t=document.getElementById("poly-view");t&&t.classList.contains("active")&&x.forEach(n=>n.resize())}}z.forEach(s=>{s.addEventListener("click",()=>{const t=s.getAttribute("data-view");z.forEach(n=>n.classList.remove("active")),s.classList.add("active"),R.forEach(n=>{n.classList.remove("active"),n.id===t&&(n.classList.add("active"),t==="simple-view"&&w?w.resize():t==="poly-view"&&x.forEach(l=>l.resize()))})})});H.addEventListener("click",async()=>{await q.initialize()?(O.style.display="none",V(),N()):alert("Could not access microphone. Please check permissions.")});function N(){q.audioContext&&q.audioContext.state==="suspended"&&q.audioContext.resume();const s=document.getElementById("simple-view");if(s&&s.classList.contains("active")){const t=q.getMonoNote()||{cents:0,frequency:0,isDetected:!1};w&&w.update({...t,isDetected:!!t.name})}else if(x.length>0){const t=q.getPolyNotes(E);x.forEach((n,l)=>{const i=E[l],e=t.find(a=>{const c=typeof a.frequency=="number"?a.frequency:parseFloat(a.frequency);return Math.abs(1200*Math.log2(c/i.targetFreq))<200});if(e){const a=typeof e.frequency=="number"?e.frequency:parseFloat(e.frequency),c=1200*Math.log2(a/i.targetFreq);n.update({...e,cents:c,isDetected:!0})}else n.update({cents:0,frequency:i.targetFreq,isDetected:!1})})}requestAnimationFrame(N)}
